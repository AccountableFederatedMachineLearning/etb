<!doctype html>
<html>

<head>
  <title>Report</title>
  <style>
    body {
      margin: 40px auto;
      max-width: 650px;
      line-height: 1.6;
      padding: 0 10px
    }

    h1,
    h2,
    h3 {
      line-height: 1.2
    }

    .yellow {
      background: yellow;
    }

    .green {
      border: solid green;
    }

    #facts {
      font-family: monospace;
      display: inline-block;
    }
  </style>
</head>

<body>

  <h1>Node status</h1>

  <!--
  <p id="b(200, 4)">If this text has yellow background, then the claim b(200, 4)
    has been proved locally. If the text has a green border, then it is
    logged on the ledger.
  </p>
  -->

  <h2>Unsorted facts</h2>

  <p>
    Facts with yellow background have been established tentatively.
    Facts with a green border agree with what is recorded on the ledger.
  </p>

  <ul id="facts"> </ul>

  <script src="/socket.io/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script>
    var socket = io();
    socket.on('fact', function (msg) {
      let id = msg.literal;
      if (document.getElementById(id) === null) {
        $('#facts')
          .append($('<li>')
            .append($(`<div>`)
              .attr("id", id)
              .text(getFirstCN(msg.principal.subject) + " attests " + msg.literal)));
      }
      $(document.getElementById(id)).addClass(msg.color);
    });

    function getFirstCN(dn) {
      for (let i of dn) {
        if (i.CN) {
          return i.CN;
        }
      }
      return "?";
    }
  </script>
</body>

</html>